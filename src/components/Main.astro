---
// Main.astro
import About from './About.astro';
import Experiencia from './Experiencia.astro';
import Proyectos from './Proyectos.astro';
import Skills from './Skills.astro';
import Contacto from './Contacto.astro';

---
<main>
    <article id="about">
        <img src="/avatar.webp" alt="Foto de Javier Ruiz Molero" id="avatar" />
        <div id="info">
            <h2>JAVIERM.DEV</h2>
            <p>Desarrollador web</p>
            <section id="social-media">
                <!--Redes Sociales -->
                <article>
                    <a href="https://github.com/javierrm11">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github">
                            <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
                        </svg>
                    </a>
                </article>
                <article>
                    <a href="https://www.linkedin.com/in/javierrm11">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-linkedin">
                            <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
                            <rect x="2" y="9" width="4" height="12"></rect>
                            <circle cx="4" cy="4" r="2"></circle>
                        </svg>
                    </a>
                </article>
                <article>
                    <!-- Instagram -->
                     <a href="https://www.instagram.com/javiermdevweb/">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-instagram">
                            <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                            <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                            <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                        </svg>
                     </a>
                </article>
            </section>
        </div>
        <div id="curriculum">
            <a href="/Javier_RuizMolero_Curriculum.pdf" download>Descargar CV</a>
        </div>
    </article>
    <About />
    <Experiencia />
    <Proyectos />
    <Skills />
    <Contacto />

</main>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";

    gsap.registerPlugin(ScrollTrigger);

    // Animación inicial de la página
    document.addEventListener('DOMContentLoaded', function() {
        // Animación de entrada inicial
        const initialTl = gsap.timeline();
        
        initialTl
            .fromTo("#header", 
                { y: -100, opacity: 0 },
                { y: 0, opacity: 1, duration: 1, ease: "power3.out" }
            )
            .fromTo("#avatar", 
                { scale: 0, rotation: -180 },
                { scale: 1, rotation: 0, duration: 1.2, ease: "back.out(1.7)" },
                "-=0.5"
            )
            .fromTo("#info h2", 
                { y: 50, opacity: 0 },
                { y: 0, opacity: 1, duration: 0.8, ease: "power3.out" },
                "-=0.3"
            )
            .fromTo("#info p", 
                { y: 30, opacity: 0 },
                { y: 0, opacity: 1, duration: 0.8, ease: "power3.out" },
                "-=0.4"
            )
            .fromTo("#social-media", 
                { scale: 0, opacity: 0 },
                { 
                    scale: 1, 
                    opacity: 1, 
                    duration: 0.6, 
                    stagger: 0.15,
                    ease: "back.out(1.5)"
                },
                "-=0.3"
            )
            .fromTo("#curriculum", 
                { y: 30, opacity: 0 },
                { y: 0, opacity: 1, duration: 0.8, ease: "power3.out" },
                "-=0.2"
            );
    });

    // Animación de transición entre about y about-me
    const aboutTransition = gsap.timeline({
        scrollTrigger: {
            trigger: "#about",
            start: "top top",
            end: "bottom center",
            scrub: 1,
            markers: false // Cambiar a true para debug
        }
    });

    aboutTransition
        .to("#about", { 
            y: -100, 
            opacity: 0, 
            scale: 0.8,
            duration: 1.5,
            ease: "power2.inOut"
        })
        .to("#about-me", { 
            y: 0, 
            opacity: 1, 
            duration: 1.5,
            ease: "power2.out"
        }, "-=1");

    // Animación para la sección About Me
    gsap.timeline({
        scrollTrigger: {
            trigger: "#about-me",
            start: "top 80%",
            end: "bottom 20%",
            toggleActions: "play none none reverse"
        }
    })
    .fromTo("#about-me .about-content", 
        { y: 100, opacity: 0 },
        { y: 0, opacity: 1, duration: 1.2, ease: "power3.out" }
    )
    .fromTo("#about-me .image-container", 
        { x: -100, opacity: 0 },
        { x: 0, opacity: 1, duration: 1, ease: "back.out(1.5)" },
        "-=0.8"
    );

    // Animación para la sección Experiencia
    gsap.timeline({
        scrollTrigger: {
            trigger: "#experiencia",
            start: "top 80%",
            end: "bottom 20%",
            toggleActions: "play none none reverse"
        }
    })
    .fromTo("#experiencia h2", 
        { y: 50, opacity: 0 },
        { y: 0, opacity: 1, duration: 0.8, ease: "power3.out" }
    )
    .fromTo(".job-card", 
        { 
            y: 100, 
            opacity: 0,
            rotationX: 45
        },
        { 
            y: 0, 
            opacity: 1,
            rotationX: 0,
            duration: 1,
            stagger: 0.3,
            ease: "back.out(1.2)"
        },
        "-=0.4"
    );

    // Animación para la línea de tiempo de experiencia
    gsap.timeline({
        scrollTrigger: {
            trigger: ".experience-timeline",
            start: "top 70%",
            end: "bottom 30%",
            scrub: 1
        }
    })
    .fromTo(".timeline-line", 
        { scaleY: 0, transformOrigin: "top center" },
        { scaleY: 1, duration: 2, ease: "power2.out" }
    )
    .fromTo(".job-indicator", 
        { scale: 0, opacity: 0 },
        { 
            scale: 1, 
            opacity: 1, 
            duration: 0.8,
            stagger: 0.4,
            ease: "back.out(1.5)"
        },
        "-=1.5"
    );

    // Animación para la sección Proyectos
    const projectsTl = gsap.timeline({
        scrollTrigger: {
            trigger: "#proyectos",
            start: "top 80%",
            end: "bottom 20%",
            toggleActions: "play none none reverse"
        }
    });

    projectsTl
        .fromTo("#proyectos h2", 
            { y: 50, opacity: 0 },
            { y: 0, opacity: 1, duration: 0.8, ease: "power3.out" }
        )
        .fromTo(".project-card", 
            { 
                y: 100, 
                opacity: 0,
                rotationY: 90
            },
            { 
                y: 0, 
                opacity: 1,
                rotationY: 0,
                duration: 1.2,
                stagger: 0.2,
                ease: "back.out(1.3)"
            },
            "-=0.5"
        );

    // Efecto parallax para las imágenes de proyectos
    gsap.utils.toArray(".project-card").forEach((card, i) => {
        gsap.to(card, {
            y: i % 2 === 0 ? -30 : 30,
            ease: "none",
            scrollTrigger: {
                trigger: card,
                start: "top bottom",
                end: "bottom top",
                scrub: 1
            }
        });
    });

    // Animación para la sección Skills
    gsap.timeline({
        scrollTrigger: {
            trigger: "#skills",
            start: "top 80%",
            end: "bottom 20%",
            toggleActions: "play none none reverse"
        }
    })
    .fromTo("#skills h2", 
        { y: 50, opacity: 0 },
        { y: 0, opacity: 1, duration: 0.8, ease: "power3.out" }
    )
    .fromTo(".skill-category", 
        { 
            y: 100, 
            opacity: 0,
            scale: 0.8
        },
        { 
            y: 0, 
            opacity: 1,
            scale: 1,
            duration: 1,
            stagger: 0.3,
            ease: "back.out(1.2)"
        },
        "-=0.4"
    )
    .fromTo(".skill-tag", 
        { 
            scale: 0,
            rotation: -180
        },
        { 
            scale: 1,
            rotation: 0,
            duration: 0.6,
            stagger: 0.05,
            ease: "back.out(1.7)"
        },
        "-=0.6"
    );

    // Animación para la sección Contacto
    gsap.timeline({
        scrollTrigger: {
            trigger: "#contact",
            start: "top 80%",
            end: "bottom 20%",
            toggleActions: "play none none reverse"
        }
    })
    .fromTo("#contact h2", 
        { y: 50, opacity: 0 },
        { y: 0, opacity: 1, duration: 0.8, ease: "power3.out" }
    )
    .fromTo(".contact-card", 
        { 
            x: -100, 
            opacity: 0
        },
        { 
            x: 0, 
            opacity: 1,
            duration: 0.8,
            stagger: 0.2,
            ease: "power3.out"
        },
        "-=0.4"
    )
    

    // Animación de elementos flotantes en el fondo
    gsap.to(".floating-bg", {
        y: 30,
        rotation: 360,
        duration: 20,
        repeat: -1,
        yoyo: true,
        ease: "sine.inOut",
        stagger: {
            amount: 5,
            from: "random"
        }
    });

    // Animación de scroll para el header
    ScrollTrigger.create({
        start: "top -100",
        end: 99999,
        toggleClass: { className: "scrolled", targets: "#header" }
    });

    // Animación de texto typewriter para el título
    gsap.to("#info h2", {
        text: "JAVIERM.DEV",
        duration: 2,
        ease: "none",
        delay: 0.5
    });

    // Efecto de partículas/interactividad
    document.addEventListener('mousemove', (e) => {
        const cursor = document.createElement('div');
        cursor.style.cssText = `
            position: fixed;
            width: 6px;
            height: 6px;
            background: var(--highlight-color);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            left: ${e.clientX}px;
            top: ${e.clientY}px;
            opacity: 0.7;
        `;
        document.body.appendChild(cursor);
        
        gsap.to(cursor, {
            scale: 0,
            opacity: 0,
            duration: 0.5,
            ease: "power2.out",
            onComplete: () => cursor.remove()
        });
    });



    // Efecto de revelado progresivo al hacer scroll
    gsap.utils.toArray('.reveal-on-scroll').forEach(element => {
        gsap.fromTo(element, 
            { 
                y: 50, 
                opacity: 0 
            },
            {
                y: 0,
                opacity: 1,
                duration: 1,
                ease: "power3.out",
                scrollTrigger: {
                    trigger: element,
                    start: "top 85%",
                    end: "bottom 20%",
                    toggleActions: "play none none reverse"
                }
            }
        );
    });

    // Animación de entrada del footer
    const footerTl = gsap.timeline({
            scrollTrigger: {
                trigger: "#footer",
                start: "top 90%",
                end: "bottom top",
                toggleActions: "play none none reverse"
            }
        });

        footerTl
            .to(".footer-section", {
                y: 0,
                opacity: 1,
                duration: 0.8,
                stagger: 0.2,
                ease: "power3.out"
            })
            .to(".footer-divider", {
                scaleX: 1,
                duration: 1,
                ease: "power2.out"
            }, "-=0.4")
            .to(".bottom-content", {
                y: 0,
                opacity: 1,
                duration: 0.6,
                ease: "power3.out"
            }, "-=0.3");

        // Animación continua de elementos flotantes
        gsap.to(".footer-floating", {
            y: 20,
            rotation: 360,
            duration: 15,
            repeat: -1,
            yoyo: true,
            ease: "sine.inOut",
            stagger: {
                amount: 3,
                from: "random"
            }
        });

        // Efecto hover mejorado para los social links
        document.querySelectorAll('.social-link').forEach(link => {
            link.addEventListener('mouseenter', function() {
                gsap.to(this, {
                    scale: 1.1,
                    duration: 0.3,
                    ease: "back.out(1.7)"
                });
            });
            
            link.addEventListener('mouseleave', function() {
                gsap.to(this, {
                    scale: 1,
                    duration: 0.3,
                    ease: "power2.out"
                });
            });
        });

        // Efecto hover para los enlaces del footer
        document.querySelectorAll('.footer-links a').forEach(link => {
            link.addEventListener('mouseenter', function() {
                gsap.to(this, {
                    x: 5,
                    duration: 0.3,
                    ease: "power2.out"
                });
            });
            
            link.addEventListener('mouseleave', function() {
                gsap.to(this, {
                    x: 0,
                    duration: 0.3,
                    ease: "power2.out"
                });
            });
        });

</script>